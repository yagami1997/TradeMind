# TradeMind 轻量版重构计划

## 背景与目标

TradeMind 轻量版是一个基于 Python 的美股技术分析工具，目前的代码主要集中在一个超过 2000 行的 `StockAnalyzer` 类中。尽管功能表现良好，但这种结构使代码难以维护和扩展。

**核心原则**：
- 保持功能与结果不变
- 仅进行代码重组，最小化重写
- 提高可维护性和可读性
- 为未来功能扩展创建合理结构

## 拟定架构

```
trademind/
├── core/
│   ├── __init__.py
│   ├── analyzer.py        # 主分析类（原stock_analyzer.py精简版）
│   ├── indicators.py      # 技术指标计算（RSI, MACD, KDJ等）
│   └── patterns.py        # K线形态识别
├── strategies/
│   ├── __init__.py
│   ├── signals.py         # 交易信号生成逻辑
│   └── backtest.py        # 回测系统
├── reports/
│   ├── __init__.py
│   └── html_generator.py  # HTML报告生成
├── config/                # 保持不变
│   └── watchlists.json
├── main.py                # 保持不变
└── stock_analyzer.py      # 保留为兼容层
```

## 实施步骤

### 1. 准备阶段
- 创建新的目录结构
- 准备模块文件和必要的导入语句

### 2. 代码迁移阶段
- **技术指标迁移**：将计算RSI、MACD、KDJ、布林带等函数搬运到`core/indicators.py`
- **形态识别迁移**：将K线形态识别代码搬运到`core/patterns.py`
- **信号生成迁移**：将交易建议和信号生成逻辑搬运到`strategies/signals.py`
- **回测系统迁移**：将回测逻辑搬运到`strategies/backtest.py`
- **报告生成迁移**：将HTML报告生成代码搬运到`reports/html_generator.py`

### 3. 主类重构阶段
- 修改`core/analyzer.py`调用新模块函数
- 保留核心工作流程和用户交互逻辑

### 4. 兼容层阶段
- 修改原`stock_analyzer.py`，使其成为对新架构的简单封装
- 确保对外API保持一致，实现无缝过渡

### 5. 测试与验证阶段
- 确保重构后的系统产生与原系统相同的结果
- 验证所有功能正常工作

## 注意事项

1. **代码搬运优先**：尽量直接复制代码，而非重写
2. **保持函数签名**：在迁移函数时保持原参数和返回值不变
3. **适当注释**：添加必要注释说明函数用途和来源
4. **增量实现**：每完成一个模块的迁移就进行测试
5. **优先保证功能**：功能正确性优先于架构完美性

## 风险控制

1. **备份原始代码**：开始重构前备份原代码
2. **提交频率**：小步提交，每个功能模块迁移完成后提交一次
3. **回退策略**：出现问题时能快速回退到已知正常状态

## 后续扩展方向

重构完成后，这个架构将有利于以下方向的扩展：
- 增加更多技术指标
- 添加新的K线形态识别
- 支持额外的报告格式
- 引入简单的投资组合分析
- 添加更丰富的可视化效果

请记住，重构目标是优化结构，不是改变功能。新功能应在重构稳定后再考虑添加。

---
*最后更新: 2025-03-16 21:58:33 PDT*
